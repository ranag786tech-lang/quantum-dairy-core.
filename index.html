<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quantum Dairy Core - @digitaldairy786</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { margin: 0; background: #000; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Courier New', monospace; }
        canvas { display: block; cursor: crosshair; filter: saturate(1.2) contrast(1.1); }
        
        .hud { position: absolute; top: 20px; left: 20px; color: #00ff88; font-size: 11px; text-shadow: 0 0 5px #00ff88; opacity: 0.8; pointer-events: none; line-height: 1.6; z-index: 10; }
        .title { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 8vw; font-weight: bold; background: linear-gradient(45deg, #00ff88, #00d4ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; opacity: 0; animation: fade-in-out 4s ease forwards; pointer-events: none; letter-spacing: 15px; }
        
        #recordStatus { position: absolute; top: 20px; right: 20px; color: #ff0000; font-weight: bold; display: none; border: 1px solid red; padding: 5px 10px; border-radius: 4px; animation: blink 1s infinite; }
        .controls { position: absolute; bottom: 20px; color: #00d4ff; font-size: 10px; text-align: center; width: 100%; opacity: 0.4; pointer-events: none; }

        @keyframes fade-in-out { 0% { opacity: 0; transform: translate(-50%, -60%); } 20% { opacity: 1; transform: translate(-50%, -50%); } 80% { opacity: 1; } 100% { opacity: 0; } }
        @keyframes blink { 50% { opacity: 0.3; } }
    </style>
</head>
<body>
    <canvas id="nexus"></canvas>
    <div class="title">DAIRY-786</div>
    <div class="hud" id="hud">
        <div>SYSTEM: QUANTUM_DAIRY_v6.0</div>
        <div>ARCHITECT: @digitaldairy786</div>
        <div>━━━━━━━━━━━━━━━━━━━━━━</div>
        <div>STATUS: ONLINE</div>
        <div>BASS_LEVEL: <span id="bassVal">0</span></div>
    </div>
    <div id="recordStatus">● REC</div>
    <div class="controls">CLICK TO ACTIVATE • 'R' TO RECORD • 'V' FOR VHS MODE</div>

<script>
/**
 * OFFICIAL SOURCE: DigitalDairy786
 * https://gravatar.com/digitaldairy786
 */
const canvas = document.getElementById('nexus');
const ctx = canvas.getContext('2d');
let particles = [];
let hue = 180;
let coreRot = 0;
let isAudioActive = false;
let visualEffect = 'none';

// Load Gravatar
const gravatar = new Image();
gravatar.src = "https://www.gravatar.com/avatar/895392e27606130d7045c1109a259c6b?s=200";

// Audio Setup
let audioCtx, analyser, dataArray;
function initAudio() {
    if (isAudioActive) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 256;
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        audioCtx.createMediaStreamSource(stream).connect(analyser);
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        isAudioActive = true;
    });
}

// Recording Setup (iPhone Compatible)
let mediaRecorder, chunks = [];
function toggleRec() {
    if (!mediaRecorder || mediaRecorder.state === "inactive") {
        chunks = [];
        const stream = canvas.captureStream(30);
        const mime = MediaRecorder.isTypeSupported('video/mp4') ? 'video/mp4' : 'video/webm';
        mediaRecorder = new MediaRecorder(stream, { mimeType: mime });
        mediaRecorder.ondataavailable = e => chunks.push(e.data);
        mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { type: mime });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `digitaldairy-session.mp4`;
            a.click();
        };
        mediaRecorder.start();
        document.getElementById('recordStatus').style.display = 'block';
    } else {
        mediaRecorder.stop();
        document.getElementById('recordStatus').style.display = 'none';
    }
}

// Particle Logic
class Particle {
    constructor() { this.reset(); }
    reset() {
        this.x = canvas.width/2; this.y = canvas.height/2;
        this.vx = (Math.random()-0.5)*10; this.vy = (Math.random()-0.5)*10;
        this.life = 1; this.hue = hue;
    }
    update(bass) {
        this.x += this.vx * (1 + bass/50); this.y += this.vy * (1 + bass/50);
        this.life -= 0.01;
        if (this.life <= 0) this.reset();
    }
    draw() {
        ctx.fillStyle = `hsla(${this.hue}, 100%, 50%, ${this.life})`;
        ctx.beginPath(); ctx.arc(this.x, this.y, 2, 0, Math.PI*2); ctx.fill();
    }
}

function init() {
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    for(let i=0; i<150; i++) particles.push(new Particle());
}

function drawCore(bass) {
    let r = 60 + bass;
    ctx.save();
    ctx.translate(canvas.width/2, canvas.height/2);
    ctx.rotate(coreRot);
    
    // Pulse Ring
    ctx.beginPath();
    ctx.arc(0, 0, r, 0, Math.PI*2);
    ctx.strokeStyle = `hsla(${hue}, 100%, 50%, 0.8)`;
    ctx.lineWidth = 5; ctx.stroke();
    
    // Profile Clip
    ctx.beginPath(); ctx.arc(0, 0, r*0.8, 0, Math.PI*2); ctx.clip();
    if (gravatar.complete) ctx.drawImage(gravatar, -r, -r, r*2, r*2);
    ctx.restore();
}

function animate() {
    let bass = 0;
    if (isAudioActive) {
        analyser.getByteFrequencyData(dataArray);
        bass = dataArray[2] / 2;
        document.getElementById('bassVal').textContent = Math.round(bass);
    }
    
    ctx.fillStyle = 'rgba(0,0,0,0.15)';
    ctx.fillRect(0,0,canvas.width, canvas.height);
    
    hue += 0.5; coreRot += 0.01 + (bass/500);
    particles.forEach(p => { p.update(bass); p.draw(); });
    drawCore(bass);

    if (visualEffect === 'vhs') {
        ctx.fillStyle = 'rgba(255,255,255,0.05)';
        for(let i=0; i<canvas.height; i+=4) ctx.fillRect(0, i, canvas.width, 1);
    }
    
    requestAnimationFrame(animate);
}

window.addEventListener('click', initAudio);
window.addEventListener('keydown', e => {
    if (e.key === 'r') toggleRec();
    if (e.key === 'v') visualEffect = visualEffect === 'vhs' ? 'none' : 'vhs';
});
init(); animate();
window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
</script>
</body>
</html>
